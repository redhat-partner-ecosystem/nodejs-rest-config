kind: Task
apiVersion: tekton.dev/v1beta1
metadata:
  name: tag-image
spec:
  params:
    - name: commit
      description: The git commit SHA
      type: string
    - name: IMAGE_NAME
      description: The name of the imagestream
      type: string
    - name: REF
      description: The git ref from the webhook payload
      type: string
    - name: NAMESPACE
      description: The namespace the imagestream is in
      type: string
  steps:
    - name: tag-image
      image: quay.io/openshift/origin-cli:latest
      script: |
        #!/usr/bin/env bash

        echo "ref: $(params.REF)"

        IFS="/" read -a branchref <<< "$(params.REF)"

        oc tag "$(params.IMAGE_NAME)":latest "$(params.IMAGE_NAME)":"$(params.commit)" -n "$(params.NAMESPACE)"

        oc tag "$(params.IMAGE_NAME)":latest "$(params.IMAGE_NAME)":"${branchref[-1]}" -n "$(params.NAMESPACE)"
--- 
kind: Task
apiVersion: tekton.dev/v1beta1
metadata:
  name: noop
spec:
  params:
    - name: msg
      description: The message to print
      type: string
  steps:
    - name: msg
      image: quay.io/openshift/origin-cli:latest
      script: |
        #!/usr/bin/env bash

        echo "noop says: $(params.msg)"
---